Goal: Fix two build errors:
1) "Export logger doesn't exist in target module" when importing from '@/utils/logger'
2) "Property 'get' does not exist on type Promise<ReadonlyHeaders>" for `headers().get(...)` in API routes

Make surgical changes only. Do not alter behavior.

FILES TO EDIT
- utils/logger.ts
- app/api/nfl-2025/offense/route.ts
- app/api/nfl-2025/defense/route.ts

CONTEXT
- We currently export { log, LOG_LEVEL } from utils/logger.ts (no 'logger' object).
- Some routes import `{ logger }` and call `logger.cache(...)` and `logger.performance(...)`.
- Next.js 15’s `next/headers` can be async; our code assumed sync `.get()`. We will use the Request parameter instead.

TASKS

A) utils/logger.ts — add a tiny compatibility shim export
1. Keep existing exports `LOG_LEVEL` and `log` as-is.
2. Add a new named export `logger` that preserves current call sites:
   - `logger.cache(ctx, msg, meta)` → internally call `log('debug', '[CACHE]', ctx, msg, meta)`
   - `logger.performance(ctx, msg, meta)` → `log('info', '[PERF]', ctx, msg, meta)`
   - Also include passthrough helpers: `logger.debug`, `logger.info`, `logger.warn`, `logger.error` that call `log(...)`

Code to append at bottom of utils/logger.ts:
```ts
export const logger = {
  cache(ctx: any, msg: string, meta?: any) {
    log('debug', '[CACHE]', ctx, msg, meta);
  },
  performance(ctx: any, msg: string, meta?: any) {
    log('info', '[PERF]', ctx, msg, meta);
  },
  debug(...args: any[]) {
    log('debug', ...args);
  },
  info(...args: any[]) {
    log('info', ...args);
  },
  warn(...args: any[]) {
    log('warn', ...args);
  },
  error(...args: any[]) {
    log('error', ...args);
  },
} as const;
B) offense/route.ts and defense/route.ts — fix If-None-Match access and ETag flow

Change the GET signatures to accept the Request parameter:

ts
Copy code
export async function GET(request: Request) { ... }
Remove any import { headers } from 'next/headers' usage in these two files.

Read the request header directly:

ts
Copy code
const ifNoneMatch = request.headers.get('if-none-match') || undefined;
Keep the rest of the logic same (cache HIT/MISS handling, stale fallback, logging).

Ensure we continue to set an ETag header on 200/304 responses.

(If present) Update any references that assumed headers() to instead use the local ifNoneMatch string variable.

C) Type check + behavior checks

pnpm typecheck (or npm run typecheck) must pass with 0 errors.

pnpm dev runs without build errors.

Manual test:

GET /api/nfl-2025/offense → returns 200 + ETag "abc..."

GET again with If-None-Match: "abc..." → returns 304 Not Modified

Same for /defense

D) Do NOT change any public response shapes, cache max-age values, or logs content beyond using the shim. Keep all headers like X-Cache, X-Request-ID etc.

After changes, print a short summary of what changed.

At end of your reply, add:

Microlearning
Explain why using a Request parameter for headers is safer in Next.js 15 and how a logger shim preserves API compatibility while centralizing logging.

markdown
Copy code

---

### Why this works

- **logger error:** We add a **compatibility shim** export so your existing `import { logger }` and calls like `logger.cache(...)` continue to compile, without touching multiple files.
- **headers().get error:** We use the **Request parameter** (`export async function GET(request: Request)`) and `request.headers.get(...)`, which works across Next 15 and avoids confusion about whether `headers()` is sync or async.
- Keeps your **existing cache + stale-serve logic** intact.

If you want, after Cursor runs this, paste back the summary and I’ll double-check the diffs.




